<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>RingCentral Embeddable</title>
  <meta name="description" content="RingCentral Embeddable">
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, user-scalable=0, maximum-scale=1, minimum-scale=1"
  >
  <link rel="shortcut icon" href="assets/images/favicon.ico">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <style>
    h2 {
      font-size: 18px;
      margin: 25px 0;
    }
    h3 {
      font-size: 15px;
      font-weight: 600;
    }
    p {
      margin: 10px 0;
      line-height: 25px;
      font-size: 15px;
    }
    pre {
      padding: 5px;
      overflow: auto;
      font-size: 85%;
      line-height: 1.45;
      background-color: #f7f7f7;
      border-radius: 3px;
    }
    a:focus {
      outline: none!important;
    }
    a {
      color: #0684bd;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>RingCentral Embeddable</h1>
    <h2>Two ways to integrate this widget to your web application</h2>
    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button type="button" class="nav-link active" id="adapter-tab" data-bs-toggle="tab" role="tab" data-bs-target="#adapter-way" aria-controls="adapter-way" aria-selected="true">Adapter JS Way</button>
      </li>
      <li class="nav-item" role="presentation">
        <button type="button" class="nav-link" id="iframe-tab" data-bs-toggle="tab" role="tab" data-bs-target="#iframe-way" aria-controls="iframe-way">Iframe Way</button>
      </li>
    </ul>
    <p>
      <a class="btn btn-primary dropdown-toggle" data-bs-toggle="collapse" href="#config-params" aria-expanded="false" aria-controls="config-params" role="button">
        Config
      </a>
    </p>
    <div class="collapse" id="config-params">
      <div class="card card-body">
        <p>Create a browser based app in <a href="https://developer.ringcentral.com/" target="_blank" rel="noopener noreferrer">RingCentral Developer Platform<a> to get clientId, appSecret and appServer.</p>
        <form>
          <div class="mb-3 row">
            <label for="clientId" class="col-sm-2 col-form-label">clientId</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="clientId" placeholder="Your app key of RingCentral App">
            </div>
          </div>
          <div class="mb-3 row">
            <label for="appServer" class="col-sm-2 col-form-label">appServer</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="appServer" placeholder="default: https://platform.ringcentral.com">
            </div>
          </div>
          <div class="mb-3 row">
            <label for="redirectUri" class="col-sm-2 col-form-label">redirectUri</label>
            <div class="col-sm-10">
              <input type="text" class="form-control" id="redirectUri" placeholder="default: https://ringcentral.github.io/ringcentral-embeddable/redirect.html">
            </div>
          </div>
        </form>
      </div>
    </div>
    <div class="tab-content" id="myTabContent">
      <div class="tab-pane fade show active" id="adapter-way" role="tabpanel" aria-labelledby="adapter-tab" tabindex="0">
        <p>Just add following the following codes to your website's header. It will create a iframe in your website.</p>
        <pre id="adapter-code">
&lt;script&gt;
  (function() {
    var rcs = document.createElement("script");
    rcs.src = "https://ringcentral.github.io/ringcentral-embeddable/adapter.js";
    var rcs0 = document.getElementsByTagName("script")[0];
    rcs0.parentNode.insertBefore(rcs, rcs0);
  })();
&lt;/script&gt;
        </pre>
      </div>
      <div class="tab-pane fade" id="iframe-way" role="tabpanel" aria-labelledby="iframe-tab" tabindex="0">
        <p>Create a iframe with the following codes</p>
        <pre id="iframe-code">
 &lt;iframe width="300" height="500" allow="microphone" src="https://ringcentral.github.io/ringcentral-embeddable/app.html"&gt;
 &lt;/iframe&gt;
        </pre>
      </div>
    </div>
    <p>You need to add following uri to your redirect url in app setting on developer website, if you don't config redirect widget uri.</p>
    <pre id="defaultRedirectUri">https://ringcentral.github.io/ringcentral-embeddable/redirect.html</pre>
    <p>For full document of <a href="https://github.com/ringcentral/ringcentral-embeddable#documents" target="_blank" rel="noopener noreferrer">API and Event</a>, please refer to <a href="https://github.com/ringcentral/ringcentral-embeddable#documents" target="_blank" rel="noopener noreferrer">here</a></p>
    <h2>Config your clientId in local Environment</h2>
    <p>1. Click <a href="#" id="setEnvironment">here to set this widget's client ID and app Server</a> in local. Enable and save.</p>
    <p>2. Set redirect url in RingCentral Developer Platform as the app show.</p>
    <p>In environment way, clientId and server are saved in your local storage, so it will not influence other people.</p>
    <p>This app supports authorization code and implicit grant flows. If you only provide clientId, it will use implicit grant flow. Refer <a href="https://github.com/ringcentral/ringcentral-embeddable/blob/master/docs/config-client-id-and-secret.md#notice" target="_blank" rel="noopener noreferrer">here</a> to get more details about authorization flow.</p>
    <h2>C2D demo</h2>
    <p>TEL Link: <a href="tel:+12345678888">+12345678888</a></p>
    <p>SMS Link: <a href="sms:+12345678901">+12345678901</a></p>
    <p>SMS Link with Text: <a href="sms:+12345678902?body=test_sms">+12345678902</a></p>
    <p>Text: +12345678901</p>
  </div>
  <script>
    (function () {
      var rcs = document.createElement('script');
      rcs.src = './adapter.js?notification=1&disableGlip=false&multipleTabsSupport=1&enablePopup=1&enableRingtoneSettings=1';
      var rcs0 = document.getElementsByTagName('script')[0];
      rcs0.parentNode.insertBefore(rcs, rcs0);
    })();
  </script>
  <script src="https://unpkg.com/ringcentral-c2d@1.0.0/build/index.js"></script>
  <script>
    // setup c2d
    var clickToDial = new RingCentralC2D();
    clickToDial.on(RingCentralC2D.events.call, (phoneNumber) => {
      RCAdapter.clickToCall(phoneNumber, false);
    });
    clickToDial.on(RingCentralC2D.events.text, (phoneNumber) => {
      RCAdapter.clickToSMS(phoneNumber);
    });
    // click button to change env
    var setEnvironment = window.document.querySelector('#setEnvironment');
    setEnvironment.addEventListener('click', function () {
      if (window.RCAdapter && window.RCAdapter.setEnvironment) {
        window.RCAdapter.setEnvironment();
        window.RCAdapter.setMinimized(false);
      }
    });
  </script>
  <script>
    function getConfigQuery() {
      var config = {};
      config.clientId = window.document.querySelector('#clientId').value;
      config.appServer = window.document.querySelector('#appServer').value;
      config.redirectUri = window.document.querySelector('#redirectUri').value;
      var queries = [];
      Object.keys(config).forEach(function (key) {
        if (config[key] && config[key].length > 0) {
          queries.push(key + '=' + config[key]);
        }
      });
      return queries.join('&');
    }
    function getBasePath() {
      var basePath = window.location.protocol + '//' + window.location.host + window.location.pathname;
      basePath = basePath.replace('/index.html', '');
      if (basePath[basePath.length - 1] === '/') {
        basePath = basePath.slice(0, basePath.length - 1);
      }
      return basePath;
    }
    function updateCodes() {
      var basePath = getBasePath();
      var adapterElem = window.document.querySelector('#adapter-code');
      var iframeElem = window.document.querySelector('#iframe-code');
      var query = getConfigQuery();
      var adapterCode = adapterElem.innerHTML;
      var adapterUri = adapterCode.match(/"http\S+"/)[0];
      var newAdapterUri = adapterUri.replace(/\?\S*"/, '').replace(/"$/, '');
      if (query) {
        newAdapterUri = newAdapterUri + '?' + query + '"';
      } else {
        newAdapterUri = newAdapterUri + '"';
      }
      newAdapterUri = newAdapterUri.replace('https://ringcentral.github.io/ringcentral-embeddable', basePath);
      var iframeCode = iframeElem.innerHTML;
      var iframeSrc = iframeCode.match(/"http\S+"/)[0];
      var newIframeSrc = iframeSrc.replace(/\?\S*"/, '').replace(/"$/, '');
      if (query) {
        newIframeSrc = newIframeSrc + '?' + query + '"';
      } else {
        newIframeSrc = newIframeSrc + '"';
      }
      newIframeSrc = newIframeSrc.replace('https://ringcentral.github.io/ringcentral-embeddable', basePath);
      adapterElem.innerHTML = adapterCode.replace(adapterUri, newAdapterUri);
      iframeElem.innerHTML = iframeCode.replace(iframeSrc, newIframeSrc);
    }
    updateCodes();
    function replaceRedirectUri() {
      var basePath = getBasePath();
      var defaultRedirectUriElem = window.document.querySelector('#defaultRedirectUri');
      var defaultRedirectUri = defaultRedirectUriElem.innerText;
      defaultRedirectUri = defaultRedirectUri.replace('https://ringcentral.github.io/ringcentral-embeddable', basePath);
      defaultRedirectUriElem.innerHTML = defaultRedirectUri;
      var redirectUriInput = window.document.querySelector('#redirectUri');
      redirectUriInput.setAttribute('placeholder', defaultRedirectUri);
    }
    replaceRedirectUri();
    var inputs = window.document.querySelectorAll('input');
    for (var i = 0; i < inputs.length; ++i) {
      var inputElem = inputs[i];
      inputElem.addEventListener('keyup', function () {
        updateCodes();
      });
      inputElem.addEventListener('paste', function () {
        updateCodes();
      });
      inputElem.addEventListener('blur', function () {
        updateCodes();
      });
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>
</body>
</html>
