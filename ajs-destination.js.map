{"version":3,"file":"ajs-destination.js","mappings":"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","sources":["webpack://ringcentral-embeddable/./node_modules/@segment/analytics-next/dist/pkg/lib/is-plan-event-enabled.js","webpack://ringcentral-embeddable/./node_modules/@segment/analytics-next/dist/pkg/plugins/ajs-destination/loader.js","webpack://ringcentral-embeddable/./node_modules/@segment/analytics-next/dist/pkg/plugins/ajs-destination/index.js","webpack://ringcentral-embeddable/./node_modules/@segment/analytics-next/dist/pkg/plugins/ajs-destination/utils.js"],"sourcesContent":["/**\n * Determines whether a track event is allowed to be sent based on the\n * user's tracking plan.\n * If the user does not have a tracking plan or the event is allowed based\n * on the tracking plan configuration, returns true.\n */\nexport function isPlanEventEnabled(plan, planEvent) {\n    var _a, _b;\n    // Always prioritize the event's `enabled` status\n    if (typeof (planEvent === null || planEvent === void 0 ? void 0 : planEvent.enabled) === 'boolean') {\n        return planEvent.enabled;\n    }\n    // Assume absence of a tracking plan means events are enabled\n    return (_b = (_a = plan === null || plan === void 0 ? void 0 : plan.__default) === null || _a === void 0 ? void 0 : _a.enabled) !== null && _b !== void 0 ? _b : true;\n}\n//# sourceMappingURL=is-plan-event-enabled.js.map","import { __awaiter, __generator, __spreadArray } from \"tslib\";\nimport { getNextIntegrationsURL } from '../../lib/parse-cdn';\nimport { loadScript, unloadScript } from '../../lib/load-script';\nfunction normalizeName(name) {\n    return name.toLowerCase().replace('.', '').replace(/\\s+/g, '-');\n}\nfunction obfuscatePathName(pathName, obfuscate) {\n    if (obfuscate === void 0) { obfuscate = false; }\n    return obfuscate ? btoa(pathName).replace(/=/g, '') : undefined;\n}\nexport function resolveIntegrationNameFromSource(integrationSource) {\n    return ('Integration' in integrationSource\n        ? integrationSource.Integration\n        : integrationSource).prototype.name;\n}\nfunction recordLoadMetrics(fullPath, ctx, name) {\n    var _a, _b;\n    try {\n        var metric = ((_b = (_a = window === null || window === void 0 ? void 0 : window.performance) === null || _a === void 0 ? void 0 : _a.getEntriesByName(fullPath, 'resource')) !== null && _b !== void 0 ? _b : [])[0];\n        // we assume everything that took under 100ms is cached\n        metric &&\n            ctx.stats.gauge('legacy_destination_time', Math.round(metric.duration), __spreadArray([\n                name\n            ], (metric.duration < 100 ? ['cached'] : []), true));\n    }\n    catch (_) {\n        // not available\n    }\n}\nexport function buildIntegration(integrationSource, integrationSettings, analyticsInstance) {\n    var integrationCtr;\n    // GA and Appcues use a different interface to instantiating integrations\n    if ('Integration' in integrationSource) {\n        var analyticsStub = {\n            user: function () { return analyticsInstance.user(); },\n            addIntegration: function () { },\n        };\n        integrationSource(analyticsStub);\n        integrationCtr = integrationSource.Integration;\n    }\n    else {\n        integrationCtr = integrationSource;\n    }\n    var integration = new integrationCtr(integrationSettings);\n    integration.analytics = analyticsInstance;\n    return integration;\n}\nexport function loadIntegration(ctx, name, version, obfuscate) {\n    return __awaiter(this, void 0, void 0, function () {\n        var pathName, obfuscatedPathName, path, fullPath, err_1, deps;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    pathName = normalizeName(name);\n                    obfuscatedPathName = obfuscatePathName(pathName, obfuscate);\n                    path = getNextIntegrationsURL();\n                    fullPath = \"\".concat(path, \"/integrations/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \"/\").concat(version, \"/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \".dynamic.js.gz\");\n                    _a.label = 1;\n                case 1:\n                    _a.trys.push([1, 3, , 4]);\n                    return [4 /*yield*/, loadScript(fullPath)];\n                case 2:\n                    _a.sent();\n                    recordLoadMetrics(fullPath, ctx, name);\n                    return [3 /*break*/, 4];\n                case 3:\n                    err_1 = _a.sent();\n                    ctx.stats.gauge('legacy_destination_time', -1, [\"plugin:\".concat(name), \"failed\"]);\n                    throw err_1;\n                case 4:\n                    deps = window[\"\".concat(pathName, \"Deps\")];\n                    return [4 /*yield*/, Promise.all(deps.map(function (dep) { return loadScript(path + dep + '.gz'); }))\n                        // @ts-ignore\n                    ];\n                case 5:\n                    _a.sent();\n                    // @ts-ignore\n                    window[\"\".concat(pathName, \"Loader\")]();\n                    return [2 /*return*/, window[\n                        // @ts-ignore\n                        \"\".concat(pathName, \"Integration\")]];\n            }\n        });\n    });\n}\nexport function unloadIntegration(name, version, obfuscate) {\n    return __awaiter(this, void 0, void 0, function () {\n        var path, pathName, obfuscatedPathName, fullPath;\n        return __generator(this, function (_a) {\n            path = getNextIntegrationsURL();\n            pathName = normalizeName(name);\n            obfuscatedPathName = obfuscatePathName(name, obfuscate);\n            fullPath = \"\".concat(path, \"/integrations/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \"/\").concat(version, \"/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \".dynamic.js.gz\");\n            return [2 /*return*/, unloadScript(fullPath)];\n        });\n    });\n}\nexport function resolveVersion(settings) {\n    var _a, _b, _c, _d;\n    return ((_d = (_b = (_a = settings === null || settings === void 0 ? void 0 : settings.versionSettings) === null || _a === void 0 ? void 0 : _a.override) !== null && _b !== void 0 ? _b : (_c = settings === null || settings === void 0 ? void 0 : settings.versionSettings) === null || _c === void 0 ? void 0 : _c.version) !== null && _d !== void 0 ? _d : 'latest');\n}\n//# sourceMappingURL=loader.js.map","import { __assign, __awaiter, __generator, __spreadArray } from \"tslib\";\nimport { Alias, Group, Identify, Page, Track } from '@segment/facade';\nimport { isOffline, isOnline } from '../../core/connection';\nimport { Context, ContextCancelation } from '../../core/context';\nimport { isServer } from '../../core/environment';\nimport { attempt } from '@segment/analytics-core';\nimport { isPlanEventEnabled } from '../../lib/is-plan-event-enabled';\nimport { mergedOptions } from '../../lib/merged-options';\nimport { pWhile } from '../../lib/p-while';\nimport { PriorityQueue } from '../../lib/priority-queue';\nimport { PersistedPriorityQueue } from '../../lib/priority-queue/persisted';\nimport { applyDestinationMiddleware, } from '../middleware';\nimport { buildIntegration, loadIntegration, resolveIntegrationNameFromSource, resolveVersion, unloadIntegration, } from './loader';\nimport { isPlainObject } from '@segment/analytics-core';\nimport { isDisabledIntegration as shouldSkipIntegration, isInstallableIntegration, } from './utils';\nfunction flushQueue(xt, queue) {\n    return __awaiter(this, void 0, void 0, function () {\n        var failedQueue;\n        var _this = this;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    failedQueue = [];\n                    if (isOffline()) {\n                        return [2 /*return*/, queue];\n                    }\n                    return [4 /*yield*/, pWhile(function () { return queue.length > 0 && isOnline(); }, function () { return __awaiter(_this, void 0, void 0, function () {\n                            var ctx, result, success;\n                            return __generator(this, function (_a) {\n                                switch (_a.label) {\n                                    case 0:\n                                        ctx = queue.pop();\n                                        if (!ctx) {\n                                            return [2 /*return*/];\n                                        }\n                                        return [4 /*yield*/, attempt(ctx, xt)];\n                                    case 1:\n                                        result = _a.sent();\n                                        success = result instanceof Context;\n                                        if (!success) {\n                                            failedQueue.push(ctx);\n                                        }\n                                        return [2 /*return*/];\n                                }\n                            });\n                        }); })\n                        // re-add failed tasks\n                    ];\n                case 1:\n                    _a.sent();\n                    // re-add failed tasks\n                    failedQueue.map(function (failed) { return queue.pushWithBackoff(failed); });\n                    return [2 /*return*/, queue];\n            }\n        });\n    });\n}\nvar LegacyDestination = /** @class */ (function () {\n    function LegacyDestination(name, version, writeKey, settings, options, integrationSource) {\n        if (settings === void 0) { settings = {}; }\n        this.options = {};\n        this.type = 'destination';\n        this.middleware = [];\n        this._ready = false;\n        this._initialized = false;\n        this.flushing = false;\n        this.name = name;\n        this.version = version;\n        this.settings = __assign({}, settings);\n        this.disableAutoISOConversion = options.disableAutoISOConversion || false;\n        this.integrationSource = integrationSource;\n        // AJS-Renderer sets an extraneous `type` setting that clobbers\n        // existing type defaults. We need to remove it if it's present\n        if (this.settings['type'] && this.settings['type'] === 'browser') {\n            delete this.settings['type'];\n        }\n        this.options = options;\n        this.buffer = options.disableClientPersistence\n            ? new PriorityQueue(4, [])\n            : new PersistedPriorityQueue(4, \"\".concat(writeKey, \":dest-\").concat(name));\n        this.scheduleFlush();\n    }\n    LegacyDestination.prototype.isLoaded = function () {\n        return this._ready;\n    };\n    LegacyDestination.prototype.ready = function () {\n        var _a;\n        return (_a = this.onReady) !== null && _a !== void 0 ? _a : Promise.resolve();\n    };\n    LegacyDestination.prototype.load = function (ctx, analyticsInstance) {\n        var _a;\n        return __awaiter(this, void 0, void 0, function () {\n            var integrationSource, _b;\n            var _this = this;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        if (this._ready || this.onReady !== undefined) {\n                            return [2 /*return*/];\n                        }\n                        if (!((_a = this.integrationSource) !== null && _a !== void 0)) return [3 /*break*/, 1];\n                        _b = _a;\n                        return [3 /*break*/, 3];\n                    case 1: return [4 /*yield*/, loadIntegration(ctx, this.name, this.version, this.options.obfuscate)];\n                    case 2:\n                        _b = (_c.sent());\n                        _c.label = 3;\n                    case 3:\n                        integrationSource = _b;\n                        this.integration = buildIntegration(integrationSource, this.settings, analyticsInstance);\n                        this.onReady = new Promise(function (resolve) {\n                            var onReadyFn = function () {\n                                _this._ready = true;\n                                resolve(true);\n                            };\n                            _this.integration.once('ready', onReadyFn);\n                        });\n                        this.onInitialize = new Promise(function (resolve) {\n                            var onInit = function () {\n                                _this._initialized = true;\n                                resolve(true);\n                            };\n                            _this.integration.on('initialize', onInit);\n                        });\n                        try {\n                            ctx.stats.increment('analytics_js.integration.invoke', 1, [\n                                \"method:initialize\",\n                                \"integration_name:\".concat(this.name),\n                            ]);\n                            this.integration.initialize();\n                        }\n                        catch (error) {\n                            ctx.stats.increment('analytics_js.integration.invoke.error', 1, [\n                                \"method:initialize\",\n                                \"integration_name:\".concat(this.name),\n                            ]);\n                            throw error;\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    LegacyDestination.prototype.unload = function (_ctx, _analyticsInstance) {\n        return unloadIntegration(this.name, this.version, this.options.obfuscate);\n    };\n    LegacyDestination.prototype.addMiddleware = function () {\n        var _a;\n        var fn = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            fn[_i] = arguments[_i];\n        }\n        this.middleware = (_a = this.middleware).concat.apply(_a, fn);\n    };\n    LegacyDestination.prototype.shouldBuffer = function (ctx) {\n        return (\n        // page events can't be buffered because of destinations that automatically add page views\n        ctx.event.type !== 'page' &&\n            (isOffline() || this._ready === false || this._initialized === false));\n    };\n    LegacyDestination.prototype.send = function (ctx, clz, eventType) {\n        var _a, _b;\n        return __awaiter(this, void 0, void 0, function () {\n            var plan, ev, planEvent, afterMiddleware, event, err_1;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        if (this.shouldBuffer(ctx)) {\n                            this.buffer.push(ctx);\n                            this.scheduleFlush();\n                            return [2 /*return*/, ctx];\n                        }\n                        plan = (_b = (_a = this.options) === null || _a === void 0 ? void 0 : _a.plan) === null || _b === void 0 ? void 0 : _b.track;\n                        ev = ctx.event.event;\n                        if (plan && ev && this.name !== 'Segment.io') {\n                            planEvent = plan[ev];\n                            if (!isPlanEventEnabled(plan, planEvent)) {\n                                ctx.updateEvent('integrations', __assign(__assign({}, ctx.event.integrations), { All: false, 'Segment.io': true }));\n                                ctx.cancel(new ContextCancelation({\n                                    retry: false,\n                                    reason: \"Event \".concat(ev, \" disabled for integration \").concat(this.name, \" in tracking plan\"),\n                                    type: 'Dropped by plan',\n                                }));\n                                return [2 /*return*/, ctx];\n                            }\n                            else {\n                                ctx.updateEvent('integrations', __assign(__assign({}, ctx.event.integrations), planEvent === null || planEvent === void 0 ? void 0 : planEvent.integrations));\n                            }\n                            if ((planEvent === null || planEvent === void 0 ? void 0 : planEvent.enabled) && (planEvent === null || planEvent === void 0 ? void 0 : planEvent.integrations[this.name]) === false) {\n                                ctx.cancel(new ContextCancelation({\n                                    retry: false,\n                                    reason: \"Event \".concat(ev, \" disabled for integration \").concat(this.name, \" in tracking plan\"),\n                                    type: 'Dropped by plan',\n                                }));\n                                return [2 /*return*/, ctx];\n                            }\n                        }\n                        return [4 /*yield*/, applyDestinationMiddleware(this.name, ctx.event, this.middleware)];\n                    case 1:\n                        afterMiddleware = _c.sent();\n                        if (afterMiddleware === null) {\n                            return [2 /*return*/, ctx];\n                        }\n                        event = new clz(afterMiddleware, {\n                            traverse: !this.disableAutoISOConversion,\n                        });\n                        ctx.stats.increment('analytics_js.integration.invoke', 1, [\n                            \"method:\".concat(eventType),\n                            \"integration_name:\".concat(this.name),\n                        ]);\n                        _c.label = 2;\n                    case 2:\n                        _c.trys.push([2, 5, , 6]);\n                        if (!this.integration) return [3 /*break*/, 4];\n                        return [4 /*yield*/, this.integration.invoke.call(this.integration, eventType, event)];\n                    case 3:\n                        _c.sent();\n                        _c.label = 4;\n                    case 4: return [3 /*break*/, 6];\n                    case 5:\n                        err_1 = _c.sent();\n                        ctx.stats.increment('analytics_js.integration.invoke.error', 1, [\n                            \"method:\".concat(eventType),\n                            \"integration_name:\".concat(this.name),\n                        ]);\n                        throw err_1;\n                    case 6: return [2 /*return*/, ctx];\n                }\n            });\n        });\n    };\n    LegacyDestination.prototype.track = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.send(ctx, Track, 'track')];\n            });\n        });\n    };\n    LegacyDestination.prototype.page = function (ctx) {\n        var _a;\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_b) {\n                if (((_a = this.integration) === null || _a === void 0 ? void 0 : _a._assumesPageview) && !this._initialized) {\n                    this.integration.initialize();\n                }\n                return [2 /*return*/, this.onInitialize.then(function () {\n                        return _this.send(ctx, Page, 'page');\n                    })];\n            });\n        });\n    };\n    LegacyDestination.prototype.identify = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.send(ctx, Identify, 'identify')];\n            });\n        });\n    };\n    LegacyDestination.prototype.alias = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.send(ctx, Alias, 'alias')];\n            });\n        });\n    };\n    LegacyDestination.prototype.group = function (ctx) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.send(ctx, Group, 'group')];\n            });\n        });\n    };\n    LegacyDestination.prototype.scheduleFlush = function () {\n        var _this = this;\n        if (this.flushing) {\n            return;\n        }\n        // eslint-disable-next-line @typescript-eslint/no-misused-promises\n        setTimeout(function () { return __awaiter(_this, void 0, void 0, function () {\n            var _a;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        this.flushing = true;\n                        _a = this;\n                        return [4 /*yield*/, flushQueue(this, this.buffer)];\n                    case 1:\n                        _a.buffer = _b.sent();\n                        this.flushing = false;\n                        if (this.buffer.todo > 0) {\n                            this.scheduleFlush();\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        }); }, Math.random() * 5000);\n    };\n    return LegacyDestination;\n}());\nexport { LegacyDestination };\nexport function ajsDestinations(writeKey, settings, globalIntegrations, options, routingMiddleware, legacyIntegrationSources) {\n    var _a, _b;\n    if (globalIntegrations === void 0) { globalIntegrations = {}; }\n    if (options === void 0) { options = {}; }\n    if (isServer()) {\n        return [];\n    }\n    if (settings.plan) {\n        options = options !== null && options !== void 0 ? options : {};\n        options.plan = settings.plan;\n    }\n    var routingRules = (_b = (_a = settings.middlewareSettings) === null || _a === void 0 ? void 0 : _a.routingRules) !== null && _b !== void 0 ? _b : [];\n    var remoteIntegrationsConfig = settings.integrations;\n    var localIntegrationsConfig = options.integrations;\n    // merged remote CDN settings with user provided options\n    var integrationOptions = mergedOptions(settings, options !== null && options !== void 0 ? options : {});\n    var adhocIntegrationSources = legacyIntegrationSources === null || legacyIntegrationSources === void 0 ? void 0 : legacyIntegrationSources.reduce(function (acc, integrationSource) {\n        var _a;\n        return (__assign(__assign({}, acc), (_a = {}, _a[resolveIntegrationNameFromSource(integrationSource)] = integrationSource, _a)));\n    }, {});\n    var installableIntegrations = new Set(__spreadArray(__spreadArray([], Object.keys(remoteIntegrationsConfig).filter(function (name) {\n        return isInstallableIntegration(name, remoteIntegrationsConfig[name]);\n    }), true), Object.keys(adhocIntegrationSources || {}).filter(function (name) {\n        return isPlainObject(remoteIntegrationsConfig[name]) ||\n            isPlainObject(localIntegrationsConfig === null || localIntegrationsConfig === void 0 ? void 0 : localIntegrationsConfig[name]);\n    }), true));\n    return Array.from(installableIntegrations)\n        .filter(function (name) { return !shouldSkipIntegration(name, globalIntegrations); })\n        .map(function (name) {\n        var integrationSettings = remoteIntegrationsConfig[name];\n        var version = resolveVersion(integrationSettings);\n        var destination = new LegacyDestination(name, version, writeKey, integrationOptions[name], options, adhocIntegrationSources === null || adhocIntegrationSources === void 0 ? void 0 : adhocIntegrationSources[name]);\n        var routing = routingRules.filter(function (rule) { return rule.destinationName === name; });\n        if (routing.length > 0 && routingMiddleware) {\n            destination.addMiddleware(routingMiddleware);\n        }\n        return destination;\n    });\n}\n//# sourceMappingURL=index.js.map","export var isInstallableIntegration = function (name, integrationSettings) {\n    var _a;\n    var type = integrationSettings.type, bundlingStatus = integrationSettings.bundlingStatus, versionSettings = integrationSettings.versionSettings;\n    // We use `!== 'unbundled'` (versus `=== 'bundled'`) to be inclusive of\n    // destinations without a defined value for `bundlingStatus`\n    var deviceMode = bundlingStatus !== 'unbundled' &&\n        (type === 'browser' || ((_a = versionSettings === null || versionSettings === void 0 ? void 0 : versionSettings.componentTypes) === null || _a === void 0 ? void 0 : _a.includes('browser')));\n    // checking for iterable is a quick fix we need in place to prevent\n    // errors showing Iterable as a failed destiantion. Ideally, we should\n    // fix the Iterable metadata instead, but that's a longer process.\n    return !name.startsWith('Segment') && name !== 'Iterable' && deviceMode;\n};\nexport var isDisabledIntegration = function (integrationName, globalIntegrations) {\n    var allDisableAndNotDefined = globalIntegrations.All === false &&\n        globalIntegrations[integrationName] === undefined;\n    return (globalIntegrations[integrationName] === false || allDisableAndNotDefined);\n};\n//# sourceMappingURL=utils.js.map"],"names":["isPlanEventEnabled","plan","planEvent","_a","_b","enabled","__default","normalizeName","name","toLowerCase","replace","obfuscatePathName","pathName","obfuscate","btoa","undefined","loadIntegration","ctx","version","this","obfuscatedPathName","path","fullPath","err_1","deps","label","concat","trys","push","sent","metric","window","performance","getEntriesByName","stats","gauge","Math","round","duration","_","recordLoadMetrics","Promise","all","map","dep","flushQueue","xt","queue","failedQueue","_this","length","result","pop","a","failed","pushWithBackoff","LegacyDestination","writeKey","settings","options","integrationSource","type","middleware","_ready","_initialized","flushing","disableAutoISOConversion","buffer","disableClientPersistence","scheduleFlush","prototype","isLoaded","ready","onReady","resolve","load","analyticsInstance","_c","integration","integrationSettings","integrationCtr","user","addIntegration","Integration","analytics","buildIntegration","once","onInitialize","on","increment","initialize","error","unload","_ctx","_analyticsInstance","unloadIntegration","addMiddleware","fn","_i","arguments","apply","shouldBuffer","event","send","clz","eventType","ev","afterMiddleware","track","updateEvent","integrations","All","cancel","retry","reason","applyDestinationMiddleware","traverse","invoke","call","Track","page","_assumesPageview","then","Page","identify","Identify","alias","Alias","group","Group","setTimeout","todo","random","ajsDestinations","globalIntegrations","routingMiddleware","legacyIntegrationSources","routingRules","middlewareSettings","remoteIntegrationsConfig","localIntegrationsConfig","integrationOptions","adhocIntegrationSources","reduce","acc","resolveIntegrationNameFromSource","installableIntegrations","Set","Object","keys","filter","bundlingStatus","versionSettings","deviceMode","componentTypes","includes","startsWith","isInstallableIntegration","Array","from","integrationName","allDisableAndNotDefined","_d","override","resolveVersion","destination","rule","destinationName"],"sourceRoot":""}